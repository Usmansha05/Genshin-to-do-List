<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do Tasks - Genshin Inspired To-Do App</title>
    <style>
        :root {
            --primary: #deb971;
            --primary-light: #f0d49a;
            --primary-dark: #b69049;
            --secondary: #4b5b89;
            --secondary-light: #6c7ca8;
            --background: #f5f3eb;
            --dark: #2d3047;
            --accent: #7193c3;
            --vision-anemo: #74c3af;
            --vision-geo: #fcb900;
            --vision-electro: #ad74c3;
            --vision-hydro: #4cc2f1;
            --vision-pyro: #ef7a35;
            --vision-cryo: #99ddff;
            --vision-dendro: #9ece6b;
            --element-border: #f8df8c;
            --danger: #d32f2f;
            --danger-dark: #b71c1c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(to bottom, rgba(45, 48, 71, 0.5), rgba(45, 48, 71, 0.7)), url('/bgm.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: rgba(45, 48, 71, 0.85);
            color: var(--primary);
            padding: 15px 20px;
            border-bottom: 2px solid var(--primary);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 20px rgba(0, 0, 0, 0.3);
            border-radius: 0 0 20px 20px;
            position: relative;
            z-index: 10;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--vision-anemo), var(--vision-geo), var(--vision-electro), var(--vision-hydro), var(--vision-pyro), var(--vision-cryo), var(--vision-dendro));
            border-radius: 10px 10px 0 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 28px;
            letter-spacing: 1px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(222, 185, 113, 0.7);
            position: relative;
        }

        .logo img {
            height: 74px;
            width: 92px;
            filter: drop-shadow(0 0 5px rgba(222, 185, 113, 0.5));
            border-radius: 2.5rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            background: linear-gradient(to bottom, var(--primary-light), var(--primary));
            color: var(--dark);
            border: 1px solid var(--primary-dark);
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px 20px 0 0;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to bottom, var(--primary-light), var(--primary-dark));
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: linear-gradient(to bottom, var(--secondary-light), var(--secondary));
            border: 1px solid var(--secondary);
            color: white;
            padding: 10px 15px;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background: linear-gradient(to bottom, var(--secondary-light), #3a4868);
        }

        .btn-danger {
            background: linear-gradient(to bottom, var(--danger), var(--danger-dark));
            border: 1px solid var(--danger-dark);
            color: white;
            padding: 10px 15px;
            font-size: 14px;
        }

        .btn-danger:hover {
            background: linear-gradient(to bottom, var(--danger), #9a0007);
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }

        #visionFilter {
            background: linear-gradient(to bottom, var(--secondary-light), var(--secondary));
            color: white;
            border: 1px solid var(--secondary);
            border-radius: 20px;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        #visionFilter option {
            background-color: var(--secondary);
            color: white;
            padding: 10px;
            font-size: 14px;
        }

        #visionFilter:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(222, 185, 113, 0.3);
        }

        #visionFilter:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }

        main {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            margin-top: 30px;
            padding-bottom: 30px;
        }

        .panel {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 185, 113, 0.5);
            position: relative;
            overflow: hidden;
        }

        .panel h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 22px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 12px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-header {
            grid-column: span 7;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        #currentMonth {
            font-size: 18px;
            color: var(--secondary);
            font-weight: bold;
        }

        .weekday {
            text-align: center;
            font-weight: bold;
            color: var(--dark);
            padding: 8px 5px;
            font-size: 14px;
            background-color: rgba(75, 91, 137, 0.1);
            border-radius: 10px;
        }

        .calendar-day {
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-weight: bold;
            color: var(--dark);
            border: 1px solid rgba(222, 185, 113, 0.2);
        }

        .calendar-day:hover {
            background-color: var(--primary-light);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .calendar-day.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--dark);
            border: 2px solid var(--primary-dark);
            animation: pulse 1s infinite;
        }

        .calendar-day.has-tasks::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 6px;
            height: 6px;
            background-color: var(--vision-electro);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(173, 116, 195, 0.7);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding: 5px;
        }

        .task-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(245, 245, 245, 0.9));
            border-radius: 15px;
            padding: 15px 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--vision-anemo);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            animation: glow 1.5s infinite;
        }

        .task-card.priority-high {
            border-left: 5px solid var(--vision-pyro);
        }

        .task-card.priority-medium {
            border-left: 5px solid var(--vision-electro);
        }

        .task-card.completed {
            opacity: 0.7;
            background: linear-gradient(135deg, rgba(240, 240, 240, 0.9), rgba(225, 225, 225, 0.8));
            border-left: 5px solid var(--vision-geo);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark);
            font-size: 18px;
        }

        .task-details {
            font-size: 14px;
            color: #666;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--secondary);
            font-size: 18px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
        }

        .action-btn:hover {
            background-color: var(--primary-light);
            color: var(--dark);
            transform: translateY(-3px);
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: bold;
            color: var(--secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 1px solid rgba(222, 185, 113, 0.3);
            border-radius: 10px;
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(222, 185, 113, 0.3);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .vision-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(45, 48, 71, 0.05);
            border-radius: 15px;
        }

        .vision-option {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .vision-option:hover,
        .vision-option.selected {
            transform: scale(1.2) translateY(-5px);
            border-color: var(--element-border);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .vision-anemo { background-color: var(--vision-anemo); }
        .vision-geo { background-color: var(--vision-geo); }
        .vision-electro { background-color: var(--vision-electro); }
        .vision-hydro { background-color: var(--vision-hydro); }
        .vision-pyro { background-color: var(--vision-pyro); }
        .vision-cryo { background-color: var(--vision-cryo); }
        .vision-dendro { background-color: var(--vision-dendro); }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(245, 245, 245, 0.9));
            border-radius: 20px;
            padding: 30px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(-30px);
            transition: transform 0.3s ease, opacity 0.3s ease;
            border: 2px solid var(--primary);
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--secondary);
        }

        .modal-close:hover {
            color: var(--vision-pyro);
            transform: rotate(90deg);
        }

        .genshin-notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, rgba(45, 48, 71, 0.95), rgba(35, 38, 61, 0.9));
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-left: 5px solid var(--primary);
            max-width: 350px;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
        }

        .genshin-notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .notification-icon {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-title {
            font-weight: bold;
            color: var(--primary);
            font-size: 18px;
        }

        .notification-body {
            font-size: 15px;
            margin-bottom: 10px;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: particleFade 1s ease-out forwards;
        }

        .sparkle {
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, white 0%, var(--primary) 50%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: sparkleFade 0.8s ease-out forwards;
        }

        .welcome-text {
            font-size: 18px;
            color: var(--primary-light);
            text-shadow: 0 0 5px rgba(222, 185, 113, 0.5);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(222, 185, 113, 0.5); }
            50% { box-shadow: 0 0 20px rgba(222, 185, 113, 0.8); }
            100% { box-shadow: 0 0 5px rgba(222, 185, 113, 0.5); }
        }

        @keyframes particleFade {
            0% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(calc(var(--dx) * 1px), calc(var(--dy) * 1px)); opacity: 0; }
        }

        @keyframes sparkleFade {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }

        @media (max-width: 768px) {
            main {
                grid-template-columns: 1fr;
            }

            .panel {
                padding: 15px;
            }

            .calendar-day {
                font-size: 14px;
            }

            .btn, #visionFilter {
                padding: 8px 12px;
                font-size: 12px;
            }

            .controls {
                flex-wrap: wrap;
            }

            .welcome-text {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="https://www.citypng.com/public/uploads/preview/hd-white-genshin-impact-game-logo-png-701751694788626cfr7fscsxh.png" alt="Your Tasks">
            <h1>Your Tasks</h1>
        </div>
        <div class="controls">
            <span class="welcome-text" id="welcomeText"></span>
            <button class="btn btn-secondary" id="profileBtn">Profile</button>
            <button class="btn btn-secondary" id="logoutBtn" style="display: none;">Logout</button>
            <button class="btn btn-secondary" id="loginBtn">Login</button>
            <button class="btn btn-secondary" id="syncCalendarBtn">Sync Calendar</button>
            <button class="btn" id="addTaskBtn">Add Task</button>
            <select id="visionFilter" class="btn btn-secondary" aria-label="Filter tasks by vision">
                <option value="all">All Visions</option>
                <option value="anemo">Anemo</option>
                <option value="geo">Geo</option>
                <option value="electro">Electro</option>
                <option value="hydro">Hydro</option>
                <option value="pyro">Pyro</option>
                <option value="cryo">Cryo</option>
                <option value="dendro">Dendro</option>
            </select>
        </div>
    </header>

    <div class="container">
        <main>
            <div class="panel">
                <h2>Calendar</h2>
                <div class="calendar-header">
                    <button class="btn btn-secondary" id="prevMonth"><</button>
                    <h3 id="currentMonth">April 2025</h3>
                    <button class="btn btn-secondary" id="nextMonth">></button>
                </div>
                <div class="calendar">
                    <div class="weekday">Sun</div>
                    <div class="weekday">Mon</div>
                    <div class="weekday">Tue</div>
                    <div class="weekday">Wed</div>
                    <div class="weekday">Thu</div>
                    <div class="weekday">Fri</div>
                    <div class="weekday">Sat</div>
                </div>

                <h2 style="margin-top: 20px;">Adventure Progress</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p style="text-align: center; color: var(--secondary); margin-top: 5px;">
                    Adventure Rank: <span id="adventureRank">12</span>
                </p>
            </div>

            <div class="panel">
                <h2 id="taskListTitle">Today's Tasks</h2>
                <div class="task-list" id="taskList"></div>
            </div>
        </main>
    </div>

    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <button class="modal-close" id="closeTaskModal">×</button>
            <div class="modal-header">
                <h3>Add New Task</h3>
            </div>
            <form id="addTaskForm">
                <div class="form-group">
                    <label for="taskTitle">Task Title</label>
                    <input type="text" id="taskTitle" name="taskTitle" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <textarea id="taskDescription" name="taskDescription" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskDate">Due Date</label>
                        <input type="date" id="taskDate" name="taskDate" required>
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">Priority</label>
                        <select id="taskPriority" name="taskPriority">
                            <option value="low">Low (Common)</option>
                            <option value="medium">Medium (Rare)</option>
                            <option value="high">High (Legendary)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Task Vision (Category)</label>
                    <div class="vision-selector">
                        <div class="vision-option vision-anemo" data-vision="anemo" title="Anemo - Personal"></div>
                        <div class="vision-option vision-geo" data-vision="geo" title="Geo - Work"></div>
                        <div class="vision-option vision-electro" data-vision="electro" title="Electro - Study"></div>
                        <div class="vision-option vision-hydro" data-vision="hydro" title="Hydro - Health"></div>
                        <div class="vision-option vision-pyro" data-vision="pyro" title="Pyro - Urgent"></div>
                        <div class="vision-option vision-cryo" data-vision="cryo" title="Cryo - Leisure"></div>
                        <div class="vision-option vision-dendro" data-vision="dendro" title="Dendro - Shopping"></div>
                    </div>
                </div>
                <button type="submit" class="btn">Create Task</button>
            </form>
        </div>
    </div>

    <div class="modal" id="calendarSyncModal">
        <div class="modal-content">
            <button class="modal-close" id="closeCalendarModal">×</button>
            <div class="modal-header">
                <h3>Sync Calendar</h3>
            </div>
            <form id="calendarSyncForm">
                <div class="form-group">
                    <label><input type="checkbox" name="googleCalendar" checked> Google Calendar</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="outlookCalendar"> Outlook Calendar</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="appleCalendar"> Apple Calendar</label>
                </div>
                <div class="form-group">
                    <label for="syncRange">Import events from:</label>
                    <select id="syncRange" name="syncRange">
                        <option value="week">Next 7 days</option>
                        <option value="month" selected>Next 30 days</option>
                        <option value="quarter">Next 90 days</option>
                    </select>
                </div>
                <button type="submit" class="btn">Sync Now</button>
            </form>
        </div>
    </div>

    <div class="modal" id="loginModal">
        <div class="modal-content">
            <button class="modal-close" id="closeLoginModal">×</button>
            <div class="modal-header">
                <h3>Login</h3>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginName">Select User</label>
                    <select id="loginName" name="loginName" required>
                        <option value="">-- Select User --</option>
                    </select>
                </div>
                <button type="submit" class="btn">Login</button>
                <button type="button" class="btn btn-secondary" id="registerLink">Register New User</button>
            </form>
        </div>
    </div>

    <div class="modal" id="registerModal">
        <div class="modal-content">
            <button class="modal-close" id="closeRegisterModal">×</button>
            <div class="modal-header">
                <h3>Register</h3>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regName">Name</label>
                    <input type="text" id="regName" name="regName" required>
                </div>
                <div class="form-group">
                    <label for="regAge">Age</label>
                    <input type="number" id="regAge" name="regAge" min="1" required>
                </div>
                <div class="form-group">
                    <label for="regCharacter">Favorite Genshin Character (Optional)</label>
                    <input type="text" id="regCharacter" name="regCharacter">
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    </div>

    <div class="modal" id="profileModal">
        <div class="modal-content">
            <button class="modal-close" id="closeProfileModal">×</button>
            <div class="modal-header">
                <h3>User Profile</h3>
            </div>
            <form id="profileForm">
                <div class="form-group">
                    <label for="profileName">Name</label>
                    <input type="text" id="profileName" name="profileName" required>
                </div>
                <div class="form-group">
                    <label for="profileAge">Age</label>
                    <input type="number" id="profileAge" name="profileAge" min="1" required>
                </div>
                <div class="form-group">
                    <label for="profileCharacter">Favorite Genshin Character</label>
                    <input type="text" id="profileCharacter" name="profileCharacter">
                </div>
                <div class="form-row">
                    <button type="submit" class="btn">Update Profile</button>
                    <button type="button" class="btn btn-danger" id="deleteUserBtn">Delete User</button>
                </div>
            </form>
        </div>
    </div>

    <div class="genshin-notification" id="notification">
        <div class="notification-header">
            <div class="notification-icon">!</div>
            <div class="notification-title">Notification Title</div>
        </div>
        <div class="notification-body">Notification message goes here.</div>
    </div>

    <script>
        // DOM Elements Cache
        const DOM = {
            addTaskBtn: document.getElementById('addTaskBtn'),
            syncCalendarBtn: document.getElementById('syncCalendarBtn'),
            addTaskModal: document.getElementById('addTaskModal'),
            calendarSyncModal: document.getElementById('calendarSyncModal'),
            closeTaskModal: document.getElementById('closeTaskModal'),
            closeCalendarModal: document.getElementById('closeCalendarModal'),
            addTaskForm: document.getElementById('addTaskForm'),
            calendarSyncForm: document.getElementById('calendarSyncForm'),
            taskList: document.getElementById('taskList'),
            calendarContainer: document.querySelector('.calendar'),
            currentMonthElement: document.getElementById('currentMonth'),
            prevMonthBtn: document.getElementById('prevMonth'),
            nextMonthBtn: document.getElementById('nextMonth'),
            taskListTitle: document.getElementById('taskListTitle'),
            notification: document.getElementById('notification'),
            visionOptions: document.querySelectorAll('.vision-option'),
            visionFilter: document.getElementById('visionFilter'),
            progressFill: document.getElementById('progressFill'),
            adventureRank: document.getElementById('adventureRank'),
            loginBtn: document.getElementById('loginBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            profileBtn: document.getElementById('profileBtn'),
            loginModal: document.getElementById('loginModal'),
            registerModal: document.getElementById('registerModal'),
            profileModal: document.getElementById('profileModal'),
            closeLoginModal: document.getElementById('closeLoginModal'),
            closeRegisterModal: document.getElementById('closeRegisterModal'),
            closeProfileModal: document.getElementById('closeProfileModal'),
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            profileForm: document.getElementById('profileForm'),
            registerLink: document.getElementById('registerLink'),
            welcomeText: document.getElementById('welcomeText'),
            deleteUserBtn: document.getElementById('deleteUserBtn')
        };

        // App State
        let tasks = [];
        let selectedDate = new Date();
        let currentMonth = new Date();
        let selectedVision = 'anemo';
        let selectedVisionFilter = 'all';
        let currentUser = null;

        // Utility: Debounce Function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Initialize App
        function init() {
            loadCurrentUser();
            if (!currentUser) {
                showLoginModal();
            } else {
                updateHeaderForUser();
                loadTasks();
                renderCalendar();
                renderTasks();
                setTimeout(() => {
                    showNotification('Welcome Back', `Welcome, ${currentUser.name}! Your tasks await!`);
                }, 1000);
            }
            setupEventListeners();
            setTaskDateToToday();
            updateAdventureRank();
        }

        // Set Task Date to Today
        function setTaskDateToToday() {
            const taskDate = document.getElementById('taskDate');
            taskDate.value = formatDateForInput(new Date());
        }

        // Format Date for Input
        function formatDateForInput(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // Format Date for Display
        function formatDateForDisplay(date) {
            return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
        }

        // Setup Event Listeners
        function setupEventListeners() {
            DOM.addTaskBtn.addEventListener('click', () => {
                if (!currentUser) {
                    showNotification('Please Login', 'You must be logged in to add tasks.');
                    showLoginModal();
                    return;
                }
                DOM.addTaskModal.classList.add('show');
            });
            DOM.syncCalendarBtn.addEventListener('click', () => {
                if (!currentUser) {
                    showNotification('Please Login', 'You must be logged in to sync calendar.');
                    showLoginModal();
                    return;
                }
                DOM.calendarSyncModal.classList.add('show');
            });
            DOM.closeTaskModal.addEventListener('click', () => DOM.addTaskModal.classList.remove('show'));
            DOM.closeCalendarModal.addEventListener('click', () => DOM.calendarSyncModal.classList.remove('show'));
            DOM.addTaskForm.addEventListener('submit', handleAddTask);
            DOM.calendarSyncForm.addEventListener('submit', handleSyncCalendar);

            // Authentication Listeners
            DOM.loginBtn.addEventListener('click', showLoginModal);
            DOM.logoutBtn.addEventListener('click', handleLogout);
            DOM.profileBtn.addEventListener('click', showProfileModal);
            DOM.closeLoginModal.addEventListener('click', () => DOM.loginModal.classList.remove('show'));
            DOM.closeRegisterModal.addEventListener('click', () => DOM.registerModal.classList.remove('show'));
            DOM.closeProfileModal.addEventListener('click', () => DOM.profileModal.classList.remove('show'));
            DOM.loginForm.addEventListener('submit', handleLogin);
            DOM.registerForm.addEventListener('submit', handleRegister);
            DOM.profileForm.addEventListener('submit', handleProfileUpdate);
            DOM.registerLink.addEventListener('click', () => {
                DOM.loginModal.classList.remove('show');
                DOM.registerModal.classList.add('show');
            });
            DOM.deleteUserBtn.addEventListener('click', handleDeleteUser);

            // Debounced Calendar Navigation
            DOM.prevMonthBtn.addEventListener('click', debounce(() => {
                currentMonth.setMonth(currentMonth.getMonth() - 1);
                renderCalendar();
            }, 200));

            DOM.nextMonthBtn.addEventListener('click', debounce(() => {
                currentMonth.setMonth(currentMonth.getMonth() + 1);
                renderCalendar();
            }, 200));

            // Vision Selection
            DOM.visionOptions.forEach(option => {
                option.addEventListener('click', () => {
                    DOM.visionOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedVision = option.dataset.vision;
                });
            });

            // Vision Filter
            DOM.visionFilter.addEventListener('change', () => {
                selectedVisionFilter = DOM.visionFilter.value;
                renderTasks();
            });

            // Set Default Vision
            document.querySelector('.vision-option[data-vision="anemo"]').classList.add('selected');

            // Close Modals on Outside Click
            DOM.addTaskModal.addEventListener('click', e => {
                if (e.target === DOM.addTaskModal) DOM.addTaskModal.classList.remove('show');
            });
            DOM.calendarSyncModal.addEventListener('click', e => {
                if (e.target === DOM.calendarSyncModal) DOM.calendarSyncModal.classList.remove('show');
            });
            DOM.loginModal.addEventListener('click', e => {
                if (e.target === DOM.loginModal) DOM.loginModal.classList.remove('show');
            });
            DOM.registerModal.addEventListener('click', e => {
                if (e.target === DOM.registerModal) DOM.registerModal.classList.remove('show');
            });
            DOM.profileModal.addEventListener('click', e => {
                if (e.target === DOM.profileModal) DOM.profileModal.classList.remove('show');
            });
        }

        // Show Login Modal
        function showLoginModal() {
            populateUserSelect();
            DOM.loginModal.classList.add('show');
        }

        // Show Profile Modal
        function showProfileModal() {
            if (!currentUser) {
                showNotification('Please Login', 'You must be logged in to view your profile.');
                showLoginModal();
                return;
            }
            DOM.profileForm.querySelector('#profileName').value = currentUser.name;
            DOM.profileForm.querySelector('#profileAge').value = currentUser.age;
            DOM.profileForm.querySelector('#profileCharacter').value = currentUser.favoriteCharacter || '';
            DOM.profileModal.classList.add('show');
        }

        // Populate User Select Dropdown
        function populateUserSelect() {
            const userSelect = DOM.loginForm.querySelector('#loginName');
            userSelect.innerHTML = '<option value="">-- Select User --</option>';
            const users = loadUsers();
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                userSelect.appendChild(option);
            });
        }

        // Handle Login
        function handleLogin(e) {
            e.preventDefault();
            const userId = DOM.loginForm.querySelector('#loginName').value;
            if (!userId) {
                showNotification('Error', 'Please select a user.');
                return;
            }
            const users = loadUsers();
            currentUser = users.find(user => user.id === userId);
            if (currentUser) {
                saveCurrentUser();
                updateHeaderForUser();
                DOM.loginModal.classList.remove('show');
                loadTasks();
                renderCalendar();
                renderTasks();
                showNotification('Welcome Back', `Welcome, ${currentUser.name}! Your tasks await!`);
                updateAdventureRank();
            } else {
                showNotification('Error', 'User not found.');
            }
        }

        // Handle Register
        function handleRegister(e) {
            e.preventDefault();
            const name = DOM.registerForm.querySelector('#regName').value.trim();
            const age = parseInt(DOM.registerForm.querySelector('#regAge').value);
            const favoriteCharacter = DOM.registerForm.querySelector('#regCharacter').value.trim();
            if (!name || isNaN(age)) {
                showNotification('Error', 'Please provide a valid name and age.');
                return;
            }
            const users = loadUsers();
            if (users.some(user => user.name.toLowerCase() === name.toLowerCase())) {
                showNotification('Error', 'A user with this name already exists.');
                return;
            }
            const newUser = {
                id: `user_${Date.now()}`,
                name,
                age,
                favoriteCharacter: favoriteCharacter || null
            };
            users.push(newUser);
            saveUsers(users);
            currentUser = newUser;
            saveCurrentUser();
            updateHeaderForUser();
            DOM.registerModal.classList.remove('show');
            loadTasks();
            renderCalendar();
            renderTasks();
            showNotification('Welcome', `Welcome, ${name}! You've joined the adventure!`);
            updateAdventureRank();
        }

        // Handle Profile Update
        function handleProfileUpdate(e) {
            e.preventDefault();
            const name = DOM.profileForm.querySelector('#profileName').value.trim();
            const age = parseInt(DOM.profileForm.querySelector('#profileAge').value);
            const favoriteCharacter = DOM.profileForm.querySelector('#profileCharacter').value.trim();
            if (!name || isNaN(age)) {
                showNotification('Error', 'Please provide a valid name and age.');
                return;
            }
            const users = loadUsers();
            const existingUser = users.find(user => user.name.toLowerCase() === name.toLowerCase() && user.id !== currentUser.id);
            if (existingUser) {
                showNotification('Error', 'A user with this name already exists.');
                return;
            }
            const userIndex = users.findIndex(user => user.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = {
                    ...users[userIndex],
                    name,
                    age,
                    favoriteCharacter: favoriteCharacter || null
                };
                saveUsers(users);
                currentUser = users[userIndex];
                saveCurrentUser();
                updateHeaderForUser();
                DOM.profileModal.classList.remove('show');
                showNotification('Profile Updated', 'Your profile has been updated successfully!');
            }
        }

        // Handle Delete User
        function handleDeleteUser() {
            if (!currentUser) return;
            const confirmDelete = confirm(`Are you sure you want to delete your profile, ${currentUser.name}? This will also delete all your tasks and cannot be undone.`);
            if (confirmDelete) {
                const users = loadUsers();
                const updatedUsers = users.filter(user => user.id !== currentUser.id);
                saveUsers(updatedUsers);
                try {
                    if (window.localStorage) {
                        localStorage.removeItem(`teyvatTasks_${currentUser.id}`);
                    }
                } catch (e) {
                    console.warn('localStorage not available, could not delete tasks');
                }
                const deletedName = currentUser.name;
                currentUser = null;
                saveCurrentUser();
                updateHeaderForUser();
                tasks = [];
                renderTasks();
                renderCalendar();
                DOM.profileModal.classList.remove('show');
                showLoginModal();
                showNotification('User Deleted', `The profile for ${deletedName} has been deleted.`);
            }
        }

        // Handle Logout
        function handleLogout() {
            currentUser = null;
            saveCurrentUser();
            updateHeaderForUser();
            tasks = [];
            renderTasks();
            renderCalendar();
            showLoginModal();
            showNotification('Logged Out', 'You have been logged out.');
        }

        // Update Header for User
        function updateHeaderForUser() {
            if (currentUser) {
                DOM.welcomeText.textContent = `Welcome, ${currentUser.name}!`;
                DOM.loginBtn.style.display = 'none';
                DOM.logoutBtn.style.display = 'inline-flex';
                DOM.profileBtn.style.display = 'inline-flex';
            } else {
                DOM.welcomeText.textContent = '';
                DOM.loginBtn.style.display = 'inline-flex';
                DOM.logoutBtn.style.display = 'none';
                DOM.profileBtn.style.display = 'none';
            }
        }

        // Load Users
        function loadUsers() {
            try {
                if (window.localStorage) {
                    const savedUsers = localStorage.getItem('teyvatUsers');
                    return savedUsers ? JSON.parse(savedUsers) : [];
                }
            } catch (e) {
                console.warn('localStorage not available, using empty user list');
            }
            return [];
        }

        // Save Users
        function saveUsers(users) {
            try {
                if (window.localStorage) {
                    localStorage.setItem('teyvatUsers', JSON.stringify(users));
                }
            } catch (e) {
                console.warn('localStorage not available, users will not persist');
            }
        }

        // Load Current User
        function loadCurrentUser() {
            try {
                if (window.localStorage) {
                    const userId = localStorage.getItem('teyvatCurrentUser');
                    if (userId) {
                        const users = loadUsers();
                        currentUser = users.find(user => user.id === userId) || null;
                    }
                }
            } catch (e) {
                console.warn('localStorage not available, no current user loaded');
            }
        }

        // Save Current User
        function saveCurrentUser() {
            try {
                if (window.localStorage) {
                    if (currentUser) {
                        localStorage.setItem('teyvatCurrentUser', currentUser.id);
                    } else {
                        localStorage.removeItem('teyvatCurrentUser');
                    }
                }
            } catch (e) {
                console.warn('localStorage not available, current user not saved');
            }
        }

        // Handle Add Task
        function handleAddTask(e) {
            e.preventDefault();
            const taskTitle = document.getElementById('taskTitle').value.trim();
            if (!taskTitle) return;

            const newTask = {
                id: Date.now(),
                title: taskTitle,
                description: document.getElementById('taskDescription').value.trim(),
                date: document.getElementById('taskDate').value,
                priority: document.getElementById('taskPriority').value,
                vision: selectedVision,
                completed: false,
                createdAt: new Date().toISOString()
            };

            tasks.push(newTask);
            saveTasks();
            renderTasks();
            renderCalendar();
            DOM.addTaskModal.classList.remove('show');
            DOM.addTaskForm.reset();
            setTaskDateToToday();

            // Animations
            createSparkleAnimation(DOM.addTaskBtn);
            showNotification('Task Added', `"${taskTitle}" has been added to your quest log!`);
            updateAdventureRank();
        }

        // Handle Calendar Sync
        function handleSyncCalendar(e) {
            e.preventDefault();
            const formData = new FormData(DOM.calendarSyncForm);
            const sources = [];
            if (formData.get('googleCalendar')) sources.push('Google Calendar');
            if (formData.get('outlookCalendar')) sources.push('Outlook Calendar');
            if (formData.get('appleCalendar')) sources.push('Apple Calendar');
            const range = formData.get('syncRange');

            const synced = [];
            if (sources.includes('Google Calendar')) {
                synced.push(createSampleTask('Team Meeting', 'Weekly progress update', 1, 'geo'));
                synced.push(createSampleTask('Dentist Appointment', 'Regular checkup', 7, 'hydro'));
            }
            if (sources.includes('Outlook Calendar')) {
                synced.push(createSampleTask('Project Deadline', 'Submit final report', 3, 'pyro'));
            }
            if (sources.includes('Apple Calendar')) {
                synced.push(createSampleTask('Gym Class', 'Remember water bottle', 2, 'hydro'));
                synced.push(createSampleTask('Movie Night', 'With friends', 5, 'cryo'));
            }

            tasks = [...tasks, ...synced];
            saveTasks();
            renderTasks();
            renderCalendar();
            DOM.calendarSyncModal.classList.remove('show');
            showNotification('Calendar Synced', `${synced.length} events imported from ${sources.join(', ')}`);
        }

        // Create Sample Task
        function createSampleTask(title, description, daysFromNow, vision) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromNow);
            return {
                id: Date.now() + Math.floor(Math.random() * 1000),
                title,
                description,
                date: formatDateForInput(date),
                priority: ['low', 'medium', 'high'][Math.floor(Math.random() * 3)],
                vision,
                completed: false,
                createdAt: new Date().toISOString()
            };
        }

        // Show Notification
        function showNotification(title, message) {
            DOM.notification.querySelector('.notification-title').textContent = title;
            DOM.notification.querySelector('.notification-body').textContent = message;
            DOM.notification.classList.add('show');
            setTimeout(() => DOM.notification.classList.remove('show'), 3000);
        }

        // Update Adventure Rank
        function updateAdventureRank() {
            const completedTasks = tasks.filter(task => task.completed).length;
            const totalTasks = tasks.length;
            let rank = Math.floor(completedTasks / 3) + 1;
            rank = Math.min(rank, 60);

            DOM.adventureRank.textContent = rank;
            const progress = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            DOM.progressFill.style.transition = 'width 0.5s ease';
            DOM.progressFill.style.width = `${progress}%`;
        }

        // Render Calendar
        function renderCalendar() {
            const days = DOM.calendarContainer.querySelectorAll('.calendar-day');
            days.forEach(day => day.remove());

            DOM.currentMonthElement.textContent = currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
            const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
            const firstDayIndex = firstDay.getDay();

            for (let i = 0; i < firstDayIndex; i++) {
                const blankDay = document.createElement('div');
                blankDay.classList.add('calendar-day');
                blankDay.style.visibility = 'hidden';
                DOM.calendarContainer.appendChild(blankDay);
            }

            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dayElement = document.createElement('div');
                dayElement.classList.add('calendar-day');
                dayElement.textContent = i;

                const currentDate = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), i);
                const dateString = formatDateForInput(currentDate);
                const hasTasks = tasks.some(task => task.date === dateString);
                if (hasTasks) dayElement.classList.add('has-tasks');

                if (currentDate.toDateString() === selectedDate.toDateString()) {
                    dayElement.classList.add('active');
                }

                dayElement.addEventListener('click', () => {
                    selectedDate = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), i);
                    renderCalendar();
                    renderTasks();
                });

                DOM.calendarContainer.appendChild(dayElement);
            }
        }

        // Render Tasks
        function renderTasks() {
            DOM.taskList.innerHTML = '';
            DOM.taskListTitle.textContent = `Tasks for ${formatDateForDisplay(selectedDate)}`;

            const dateString = formatDateForInput(selectedDate);
            let filteredTasks = tasks.filter(task => task.date === dateString);
            if (selectedVisionFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.vision === selectedVisionFilter);
            }

            if (filteredTasks.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.textContent = 'No tasks for this day. Add a new task!';
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.padding = '20px';
                emptyMessage.style.color = '#666';
                DOM.taskList.appendChild(emptyMessage);
                return;
            }

            filteredTasks.sort((a, b) => {
                if (a.completed && !b.completed) return 1;
                if (!a.completed && b.completed) return -1;
                const priorityValues = { high: 3, medium: 2, low: 1 };
                return priorityValues[b.priority] - priorityValues[a.priority];
            });

            filteredTasks.forEach(task => createTaskCard(task));
        }

        // Create Task Card
        function createTaskCard(task) {
            const taskCard = document.createElement('div');
            taskCard.classList.add('task-card', `priority-${task.priority}`);
            if (task.completed) taskCard.classList.add('completed');
            taskCard.style.borderLeftColor = getVisionColor(task.vision);

            taskCard.innerHTML = `
                <div class="task-content">
                    <div class="task-title">${task.title}</div>
                    <div class="task-details">${task.description || 'No description'}</div>
                </div>
                <div class="task-actions">
                    <button class="action-btn complete-btn" title="${task.completed ? 'Mark as incomplete' : 'Mark as complete'}">
                        ${task.completed ? '↩' : '✓'}
                    </button>
                    <button class="action-btn delete-btn" title="Delete task">✕</button>
                </div>
            `;

            const completeBtn = taskCard.querySelector('.complete-btn');
            const deleteBtn = taskCard.querySelector('.delete-btn');

            completeBtn.addEventListener('click', () => {
                toggleTaskCompletion(task.id, taskCard);
            });

            deleteBtn.addEventListener('click', () => {
                deleteTask(task.id);
            });

            DOM.taskList.appendChild(taskCard);
        }

        // Get Vision Color
        function getVisionColor(vision) {
            const visionColors = {
                anemo: 'var(--vision-anemo)',
                geo: 'var(--vision-geo)',
                electro: 'var(--vision-electro)',
                hydro: 'var(--vision-hydro)',
                pyro: 'var(--vision-pyro)',
                cryo: 'var(--vision-cryo)',
                dendro: 'var(--vision-dendro)'
            };
            return visionColors[vision] || visionColors.anemo;
        }

        // Toggle Task Completion
        function toggleTaskCompletion(taskId, taskCard) {
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            if (taskIndex === -1) return;

            tasks[taskIndex].completed = !tasks[taskIndex].completed;
            saveTasks();
            renderTasks();
            updateAdventureRank();

            if (tasks[taskIndex].completed) {
                createParticleAnimation(taskCard);
                console.log('Playing complete sound');
            }

            const task = tasks[taskIndex];
            showNotification('Task Updated', `"${task.title}" ${task.completed ? 'completed' : 'marked as incomplete'}`);
        }

        // Delete Task
        function deleteTask(taskId) {
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            if (taskIndex === -1) return;

            const deletedTask = tasks[taskIndex];
            tasks.splice(taskIndex, 1);
            saveTasks();
            renderTasks();
            renderCalendar();
            showNotification('Task Deleted', `"${deletedTask.title}" has been removed from your quest log`);
        }

        // Save Tasks
        function saveTasks() {
            try {
                if (window.localStorage && currentUser) {
                    localStorage.setItem(`teyvatTasks_${currentUser.id}`, JSON.stringify(tasks));
                }
            } catch (e) {
                console.warn('localStorage not available, tasks will not persist across sessions');
            }
        }

        // Load Tasks
        function loadTasks() {
            try {
                if (window.localStorage && currentUser) {
                    const savedTasks = localStorage.getItem(`teyvatTasks_${currentUser.id}`);
                    if (savedTasks) {
                        tasks = JSON.parse(savedTasks);
                        return;
                    }
                }
            } catch (e) {
                console.warn('localStorage not available, loading sample tasks');
            }

            tasks = [
                {
                    id: 1,
                    title: 'Complete Daily Commissions',
                    description: 'Finish 4 daily tasks',
                    date: formatDateForInput(new Date()),
                    priority: 'medium',
                    vision: 'anemo',
                    completed: false,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Use Original Resin',
                    description: 'Don\'t let it cap at 160/160',
                    date: formatDateForInput(new Date()),
                    priority: 'high',
                    vision: 'pyro',
                    completed: false,
                    createdAt: new Date().toISOString()
                }
            ];
        }

        // Particle Animation
        function createParticleAnimation(element) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const angle = Math.random() * 2 * Math.PI;
                const distance = 50 + Math.random() * 50;
                particle.style.left = `${centerX}px`;
                particle.style.top = `${centerY}px`;
                particle.style.setProperty('--dx', Math.cos(angle) * distance);
                particle.style.setProperty('--dy', Math.sin(angle) * distance);
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }

        // Sparkle Animation
        function createSparkleAnimation(element) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < 5; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');
                sparkle.style.left = `${centerX + (Math.random() - 0.5) * 50}px`;
                sparkle.style.top = `${centerY + (Math.random() - 0.5) * 50}px`;
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 800);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
